<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .container {
            padding: 16px;
        }
        
        .view-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
            gap: 12px;
        }
        
        .view-btn {
            background-color: #1f2937;
            color: #e5e7eb;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .view-btn:hover {
            background-color: #374151;
        }
        
        .view-btn.active {
            background-color: #4b5563;
            color: white;
        }
        
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .habit-card {
            background-color: #111827;
            border-radius: 12px;
            padding: 20px;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .emoji {
            font-size: 28px;
            margin-right: 16px;
            line-height: 1;
        }
        
        .habit-name {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }
        
        .heatmap {
            display: grid;
            gap: 4px;
            margin-top: 16px;
        }
        
        .heatmap.weekly {
            grid-template-columns: repeat(7, 1fr);
        }
        
        .heatmap.monthly {
            grid-template-columns: repeat(7, 1fr);
            grid-auto-rows: 1fr;
        }
        
        .heatmap.yearly {
            grid-template-columns: repeat(52, 1fr);
            grid-template-rows: repeat(7, 1fr);
            gap: 2px;
        }
        
        .weekday-labels {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 4px;
        }
        
        .weekday-label {
            font-size: 9px;
            color: #9ca3af;
            text-align: center;
            margin-bottom: 2px;
            text-transform: uppercase;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        .month-label {
            font-size: 12px;
            color: #e5e7eb;
            margin-bottom: 8px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.5px;
            background-color: rgba(31, 41, 55, 0.5);
            padding: 4px 0;
            border-radius: 4px;
            margin-top: 5px;
        }
        
        .day {
            aspect-ratio: 1;
            border-radius: 3px;
            transition: transform 0.2s, opacity 0.3s;
        }
        
        .day:hover {
            transform: scale(1.15);
            opacity: 0.9;
            z-index: 10;
        }
        
        .completed {
            opacity: 1;
            transform: scale(0.9);
            animation: popIn 0.4s forwards;
        }
        
        .missed {
            background-color: #374151;
            opacity: 0.4;
        }
        
        .empty {
            background-color: transparent;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .day-label {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            color: #9ca3af;
            height: 100%;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .habit-card {
            animation: fadeIn 0.3s ease forwards;
        }
        
        .habit-card:nth-child(2) {
            animation-delay: 0.1s;
        }
        
        .habit-card:nth-child(3) {
            animation-delay: 0.2s;
        }
        
        .habit-card:nth-child(4) {
            animation-delay: 0.3s;
        }
        
        .habit-card:nth-child(5) {
            animation-delay: 0.4s;
        }
        
        .habit-card:nth-child(6) {
            animation-delay: 0.5s;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/javascript">
        // Get habits data from Streamlit
        const habitsData = HABITS_DATA_PLACEHOLDER;
        
        // Function to initialize the app
        function initApp() {
            const container = document.createElement('div');
            container.className = 'container';
            
            // Create view selector
            const viewSelector = document.createElement('div');
            viewSelector.className = 'view-selector';
            
            const viewOptions = [
                { id: 'weekly', label: 'Last 7 Days' },
                { id: 'monthly', label: 'Current Month' },
                { id: 'yearly', label: 'Full Year' }
            ];
            
            // Set initial active view
            let activeView = 'weekly';
            
            // Create view buttons
            viewOptions.forEach(option => {
                const btn = document.createElement('button');
                btn.className = `view-btn ${option.id === activeView ? 'active' : ''}`;
                btn.textContent = option.label;
                btn.dataset.view = option.id;
                
                btn.addEventListener('click', () => {
                    // Update active state
                    document.querySelectorAll('.view-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    
                    // Update active view
                    activeView = option.id;
                    
                    // Redraw heatmaps
                    renderHeatmaps(activeView);
                });
                
                viewSelector.appendChild(btn);
            });
            
            container.appendChild(viewSelector);
            
            // Create habit grid
            const habitGrid = document.createElement('div');
            habitGrid.className = 'grid-container';
            habitGrid.id = 'habit-grid';
            container.appendChild(habitGrid);
            
            document.getElementById('root').appendChild(container);
            
            // Initial render
            renderHeatmaps(activeView);
        }
        
        // Function to render heatmaps
        function renderHeatmaps(viewType) {
            const grid = document.getElementById('habit-grid');
            grid.innerHTML = ''; // Clear existing cards
            
            habitsData.forEach(habit => {
                const card = createHabitCard(habit, viewType);
                grid.appendChild(card);
            });
        }
        
        // Function to create a habit card
        function createHabitCard(habit, viewType) {
            const card = document.createElement('div');
            card.className = 'habit-card';
            
            // Card header with emoji and name
            const header = document.createElement('div');
            header.className = 'card-header';
            
            const emoji = document.createElement('span');
            emoji.className = 'emoji';
            emoji.textContent = habit.emoji;
            
            const name = document.createElement('h3');
            name.className = 'habit-name';
            name.textContent = habit.name;
            
            header.appendChild(emoji);
            header.appendChild(name);
            card.appendChild(header);
            
            // Create heatmap based on view type
            const heatmap = document.createElement('div');
            heatmap.className = `heatmap ${viewType}`;
            
            const daysData = habit.daysData || [];
            
            switch(viewType) {
                case 'weekly':
                    createWeeklyHeatmap(heatmap, daysData, habit.color);
                    break;
                case 'monthly':
                    createMonthlyHeatmap(heatmap, daysData, habit.color);
                    break;
                case 'yearly':
                    createYearlyHeatmap(heatmap, daysData, habit.color);
                    break;
            }
            
            card.appendChild(heatmap);
            return card;
        }
        
        function createWeeklyHeatmap(container, daysData, color) {
            // Clear the container first
            container.innerHTML = '';
            
            // Create weekday labels container once
            if (!container.previousSibling || !container.previousSibling.classList || !container.previousSibling.classList.contains('weekday-labels')) {
                const weekdayLabels = document.createElement('div');
                weekdayLabels.className = 'weekday-labels';
                
                // Weekday names (start with Monday)
                const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                
                // Add weekday labels
                dayNames.forEach(day => {
                    const label = document.createElement('div');
                    label.className = 'weekday-label';
                    label.textContent = day;
                    weekdayLabels.appendChild(label);
                });
                
                // Add weekday labels before the heatmap
                container.parentNode.insertBefore(weekdayLabels, container);
            }
            
            // Get last 7 days
            const last7Days = daysData.slice(-7);
            
            // Organize days by weekday (Mon-Sun)
            const daysByWeekday = Array(7).fill(null);
            
            // Sort data by day of week (0 = Monday, 6 = Sunday)
            last7Days.forEach(day => {
                const date = new Date(day.date);
                let dayOfWeek = date.getDay() - 1; // Convert to 0-based (0 = Monday)
                if (dayOfWeek < 0) dayOfWeek = 6; // Handle Sunday
                daysByWeekday[dayOfWeek] = day;
            });
            
            // Weekday names for tooltips
            const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            
            // Add day cells
            daysByWeekday.forEach((day, index) => {
                const dayCell = document.createElement('div');
                dayCell.className = 'day';
                
                if (day === null) {
                    dayCell.className += ' empty';
                } else {
                    if (day.completed) {
                        dayCell.className += ' completed';
                        dayCell.style.backgroundColor = color;
                    } else {
                        dayCell.className += ' missed';
                    }
                    
                    // Format date as dd.mm
                    const date = new Date(day.date);
                    const formattedDate = `${date.getDate().toString().padStart(2, '0')}.${(date.getMonth() + 1).toString().padStart(2, '0')}`;
                    
                    // Add day label inside the cell
                    const dayLabel = document.createElement('div');
                    dayLabel.className = 'day-label';
                    dayLabel.textContent = formattedDate;
                    dayCell.appendChild(dayLabel);
                    
                    dayCell.title = `${dayNames[index]}, ${day.date}: ${day.completed ? 'Completed' : 'Not completed'}`;
                }
                
                container.appendChild(dayCell);
            });
        }
        
        function createMonthlyHeatmap(container, daysData, color) {
            // Clear the container first
            container.innerHTML = '';
            
            // Get current month and year
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            
            // Add month label - check if it exists first
            if (!container.previousSibling || !container.previousSibling.classList || !container.previousSibling.classList.contains('month-label')) {
                const monthLabel = document.createElement('div');
                monthLabel.className = 'month-label';
                monthLabel.textContent = `${monthNames[currentMonth]} ${currentYear}`;
                container.parentNode.insertBefore(monthLabel, container);
                
                // Create weekday labels container
                const weekdayLabels = document.createElement('div');
                weekdayLabels.className = 'weekday-labels';
                
                // Weekday names (start with Monday)
                const dayNames = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];
                
                // Add weekday labels
                dayNames.forEach(day => {
                    const label = document.createElement('div');
                    label.className = 'weekday-label';
                    label.textContent = day;
                    weekdayLabels.appendChild(label);
                });
                
                // Add weekday labels before the heatmap
                container.parentNode.insertBefore(weekdayLabels, container);
            }
            
            // Get days in current month
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Get first day of month (0 = Sunday, 1 = Monday, etc.)
            let firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay() - 1; // Adjust for Monday start
            if (firstDayOfMonth < 0) firstDayOfMonth = 6; // Handle Sunday
            
            // Add empty cells for days before the first of the month
            for (let i = 0; i < firstDayOfMonth; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'day empty';
                container.appendChild(emptyCell);
            }
            
            // Add day cells for each day of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDate = new Date(currentYear, currentMonth, day);
                const dayCell = document.createElement('div');
                dayCell.className = 'day';
                
                // Format date string to match the format in daysData
                const dateStr = dayDate.toISOString().split('T')[0];
                
                // Find matching day in data
                const dayData = daysData.find(d => d.date === dateStr);
                
                if (dayData && dayData.completed) {
                    dayCell.className += ' completed';
                    dayCell.style.backgroundColor = color;
                    
                    // Add day number for completed days
                    const dayLabel = document.createElement('div');
                    dayLabel.className = 'day-label';
                    dayLabel.textContent = day;
                    dayCell.appendChild(dayLabel);
                    
                    dayCell.title = `${dateStr}: Completed`;
                } else if (dayDate <= today) {
                    dayCell.className += ' missed';
                    
                    // Add day number for missed days
                    const dayLabel = document.createElement('div');
                    dayLabel.className = 'day-label';
                    dayLabel.textContent = day;
                    dayCell.appendChild(dayLabel);
                    
                    dayCell.title = dayData ? 
                        `${dateStr}: Not completed` : 
                        `${dateStr}: No data`;
                } else {
                    dayCell.className += ' empty';
                    
                    // Add day number for future days
                    const dayLabel = document.createElement('div');
                    dayLabel.className = 'day-label';
                    dayLabel.textContent = day;
                    dayCell.appendChild(dayLabel);
                }
                
                container.appendChild(dayCell);
            }
            
            // Fill remaining grid cells to complete the grid
            const rows = Math.ceil((firstDayOfMonth + daysInMonth) / 7);
            const totalCells = rows * 7;
            const cellsCount = firstDayOfMonth + daysInMonth;
            const remainingCells = totalCells - cellsCount;
            
            for (let i = 0; i < remainingCells; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'day empty';
                container.appendChild(emptyCell);
            }
        }
        
        function createYearlyHeatmap(container, daysData, color) {
            // Clear the container first
            container.innerHTML = '';
            
            // Add simple year label
            if (!container.previousSibling || !container.previousSibling.classList || !container.previousSibling.classList.contains('month-label')) {
                const yearLabel = document.createElement('div');
                yearLabel.className = 'month-label';
                yearLabel.textContent = new Date().getFullYear().toString();
                container.parentNode.insertBefore(yearLabel, container);
            }
            
            // Keep it simple for now - display a simplified version
            // Take only last 365 days of data
            const last365Days = daysData.slice(-365);
            
            // Change the grid layout
            container.style.display = 'grid';
            container.style.gridTemplateColumns = 'repeat(52, 1fr)';
            container.style.gridTemplateRows = 'repeat(7, 1fr)';
            container.style.gap = '2px';
            
            // Create a cell for each day (52 weeks Ã— 7 days)
            const totalDays = 52 * 7;
            const emptyCellsCount = totalDays - last365Days.length;
            
            // Fill with empty cells first (left side)
            for (let i = 0; i < emptyCellsCount; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'day empty';
                container.appendChild(emptyCell);
            }
            
            // Then add cells with data (right side, most recent at the end)
            last365Days.forEach((day, index) => {
                const dayCell = document.createElement('div');
                dayCell.className = 'day';
                
                if (day.completed) {
                    dayCell.className += ' completed';
                    dayCell.style.backgroundColor = color;
                    
                    // Add animation delay based on position for a wave effect
                    const delayMs = index * 2;
                    dayCell.style.animationDelay = `${delayMs}ms`;
                    
                    dayCell.title = `${day.date}: Completed`;
                } else {
                    dayCell.className += ' missed';
                    dayCell.title = `${day.date}: Not completed`;
                }
                
                container.appendChild(dayCell);
            });
        }
        
        // Initialize the app
        initApp();
    </script>
</body>
</html>